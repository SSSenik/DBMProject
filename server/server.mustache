global.__basedir = __dirname;
const express = require('express');
const mustacheExpress = require('mustache-express');

const app = express();
app.use(express.json());
app.use(
    express.urlencoded({
        extended: true,
    })
);
app.engine('mustache', mustacheExpress());
app.set('view engine', 'mustache');
app.set('views', __basedir + '/Views');
app.use(express.static(__basedir + '/public'));


const frontoffice = require('./controllers/frontoffice');
app.use('/', frontoffice);
const backoffice = require('./controllers/backoffice');
app.use('/backoffice', backoffice);

{{#schemaApis}}
const {{title}}Api = require('./controllers/{{title}}-api');
app.use('/api', {{title}}Api);
{{/schemaApis}}

const server = app.listen({{port}}, () => {
    const host =
        server.address().address === '::'
            ? 'localhost'
            : server.address().address;
    const { port } = server.address();
    console.log('Example app listening at http://%s:%s', host, port);
});
